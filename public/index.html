<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <link rel="stylesheet" href="css/dsfr.min.css">
    <link rel="stylesheet" href="css/overload-fonts.css">


    <title>
        <%= htmlWebpackPlugin.options.title %>
    </title>
    <style>
        a {
            color: orange;
        }
        
        body {
            background-color: #f9f8f6;
        }
        
        .chart_container {
            max-width: 750px;
            margin: 0 auto 50px;
        }
        
        .geo_container {
            max-width: 200px;
            margin: 0 auto 50px;
        }
    </style>
</head>

<body>

    <noscript>
    <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled.
        Please enable it to continue.</strong>
    </noscript>

    <div class="fr-container">

        <div class="fr-grid-row">

            <div class="fr-col-2 fr-col-md-4 fr-col-lg-4">
                <nav class="fr-sidemenu fr-sidemenu--sticky-full-height fr-pr-0" role="navigation" aria-label="Menu latéral">

                    <div style="position:relative; width:100%; height:0; padding-top:100%;">
                        <img style="position:absolute; top:0; left:0; width:100%;" src="Logo-ME.png" alt="Logo ME">
                    </div>

                    <div class="fr-sidemenu__inner fr-col-offset-sm-1">

                        <div class="fr-collapse fr-pt-0 fr-pt-md-4w fr-pb-md-11w" id="fr-sidemenu-wrapper">
                            <div class="fr-sidemenu__title">Affiner la recherche par territoire :</div>
                            <geo-list></geo-list>
                            <div class="fr-sidemenu__title">Naviguer par volet :</div>
                            <ul class="fr-sidemenu__list">

                                <!-- Menu déroulant permettant d'accéder aux divers indicateurs de mesures -->

                                <li class="fr-sidemenu__item">
                                    <button class="fr-sidemenu__btn" aria-expanded="true" aria-controls="volet_cohesion">
                                            Volet verdissement 
                                        </button>
                                    <div class="fr-collapse fr-collapse&#45;&#45;expanded" id="volet_cohesion" style="max-height: none; &#45;&#45;collapse:-312px;">

                                        <!-- Type :

                                            <ul class="fr-sidemenu__list">
                                                <li class="fr-sidemenu__item fr-sidemenu__item&#45;&#45;active">
                                                    <a class="fr-sidemenu__link" data-section="volet" data-name="point_de_situation" href="#refonglet" target="_self">
                                                        Texte</a>
                                                </li>
                                            </ul> -->

                                        <ul class="fr-sidemenu__list">
                                            <li class="fr-sidemenu__item fr-sidemenu__item&#45;&#45;active">
                                                <a class="fr-sidemenu__link" data-section="volet_cohesion" data-name="point_de_situation" href="#Nombre_de_contrats_d’apprentissage_bénéficiaires_de_l’aide_exceptionnelle_-_APP" target="_self">
                                                        Nombre de contrats d'apprentissage bénéficiaires de l'aide exceptionnelle - APP</a>
                                            </li>
                                        </ul>
                                    </div>
                                </li>

                                <li class="fr-sidemenu__item">
                                    <button class="fr-sidemenu__btn" aria-expanded="true" aria-controls="volet_verdissement">
                                            Volet cohésion
                                        </button>
                                    <div class="fr-collapse fr-collapse&#45;&#45;expanded" id="volet_verdissement" style="max-height: none; &#45;&#45;collapse:-312px;">
                                        <ul class="fr-sidemenu__list">
                                            <li class="fr-sidemenu__item fr-sidemenu__item&#45;&#45;active">
                                                <a class="fr-sidemenu__link" data-section="volet_verdissement" data-name="point_de_situation" href="#Nombre_de_dossiers_MaPrimeRénov_bénéficiaires_(particulier_et_copropriété)_-_MPR" target="_self">
                                                        Nombre de dossiers MaPrimeRénov bénéficiaires (particulier et copropriété) - MPR</a>
                                            </li>
                                        </ul>
                                    </div>
                                </li>

                                <li class="fr-sidemenu__item">
                                    <button class="fr-sidemenu__btn" aria-expanded="true" aria-controls="volet_compétitivité">
                                            Volet compétitivité
                                        </button>
                                    <div class="fr-collapse fr-collapse&#45;&#45;expanded" id="volet_compétitivité" style="max-height: none; &#45;&#45;collapse:-312px;">
                                        <ul class="fr-sidemenu__list">
                                            <li class="fr-sidemenu__item fr-sidemenu__item&#45;&#45;active">
                                                <a class="fr-sidemenu__link" data-section="volet_compétitivité" data-name="point_de_situation" href="#Nombre_d'entreprises_beneficiaires" target="_self">
                                                        Nombre d'entreprises bénéficiaires</a>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                        </div>
                    </div>
                </nav>
            </div>

            <div class="fr-col-12 fr-col-md-8 fr-col-lg-7 fr-col-offset-md-1 fr-mb-6w">

                <div style="position:relative; width:100%; height:0; padding-top:50%;">
                    <img style="position:absolute; top:0; left:0; width:100%;" src="Logo-France-Relance.png" alt="Logo FR">
                </div>

                <p class="fr-text--lead fr-mt-10w fr-mb-0 ">
                    Retrouvez par mois et par département l'état d'avancement des mesures phares de France Relance.
                </p>

                <div id="Panneaux">

                    <big-panel panel_id="test" source_http="http" indicateur1="Nombre_d’entreprises_-_BPI" indicateur1bis="Nombre_de_PME_-_BPI" indicateur2="Montant_cumulé_de_l’investissement_total_ainsi_déclenché_-_CBC" indicateur2bis="Nombre_d’entreprises_-_BPI" indicateur3="Montant_cumulé_de_l’investissement_total_ainsi_déclenché_-_CBC"
                        indicateur3bis="Nombre_d’entreprises_-_BPI" Propriétés_mesure="Nombre_d’entreprises_-_BPI" card_line1=2 map1=true card_line2=1 map2=true card_line3=1 map3=true card_onglet=2></big-panel>

                </div>

            </div>
        </div>
    </div>

    <script type="module" src="js/dsfr.module.min.js"></script>
    <script type="text/javascript" nomodule src="js/dsfr.nomodule.min.js"></script>

    <script>
        function to_json_name_format(nom_propilot) {
            var nom_propilot = nom_propilot.replace('_', '')
            var nom_propilot = nom_propilot.replace('/', '&')
            var nom_propilot = nom_propilot.replace('"', '')
            return nom_propilot
        };

        var config;
        fetch('config_file.json')
            .then(res => res.json())
            .then(data => config = data);

        var panneau_id_num = 0;
        for (var panneau in config) {

            console.log('hello');

            panneau_id_num += 1;
            var panneau_id = "Panneau_" + panneau_id_num;

            document.getElementById("Panneaux").innerHTML += "<big-panel id=" + panneau_id + "></big-panel>";

            document.getElementById(panneau_id).setAttribute("panel_id", panneau_id);

            var onglet1 = panneau["Onglet No 1"];

            document.getElementById(panneau_id).setAttribute("source_http", onglet1.Lien_page_mesure);
            /*            document.getElementById(panneau_id).setAttribute("source_http", onglet1.Lien_open_source); */
            document.getElementById(panneau_id).setAttribute("Propriétés_mesure", onglet1.Description_mesure);

            var onglet_id_num = 0;
            var nb_indicateurs_onglet = 0;
            for (var onglet in panneau) {
                onglet_id_num += 1;

                var temporary_subset = onglet.filter(function(Indicateur) {
                    return +(Indicateur.Indicateur_principal) == 1;
                });
                var Nom_indicateur_propilot = temporary_subset.Nom_indicateur_propilot;
                Nom_indicateur_propilot = to_json_name_format(Nom_indicateur_propilot);
                var attribute_traite = "indicateur" + String(onglet_id_num);
                document.getElementById(panneau_id).setAttribute(attribute_traite, Nom_indicateur_propilot);
                var attribute_traite = "map" + String(onglet_id_num);
                document.getElementById(panneau_id).setAttribute(attribute_traite, onglet[Indicateur_principal == 1].Carte);

                nb_indicateurs_onglet += temporary_subset.Carte;

                attribute_traite = "indicateur" + String(onglet_id_num) + "bis";
                Nom_indicateur_propilot = "Valeur_par_défaut";

                var temporary_subset = onglet.filter(function(Indicateur) {
                    return +(Indicateur.Indicateur_principal) == 0;
                });
                if (temporary_subset.length > 0) {

                    Nom_indicateur_propilot = onglet[Indicateur_principal == 0].Nom_indicateur_propilot;
                    Nom_indicateur_propilot = to_json_name_format(Nom_indicateur_propilot);
                    nb_indicateurs_onglet += 1;

                };
                document.getElementById(panneau_id).setAttribute(attribute_traite, Nom_indicateur_propilot);

                attribute_traite = "card_line" + String(onglet_id_num);
                document.getElementById(panneau_id).setAttribute(attribute_traite, nb_indicateurs_onglet);

            };

            document.getElementById(panneau_id).setAttribute("card_onglet", onglet_id_num);

        };
    </script>

</body>

</html>